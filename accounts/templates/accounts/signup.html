{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新規登録</title>
    <link rel="stylesheet" href="{% static 'css/login.css' %}">
</head>
<body>
    <div class="container">
        <div class="left-side">
            <img src="{% static 'img/animalmania_logo.png' %}" class="logo-img">
        </div>

        <div class="right-side">
            

            <div class="login-box">

                <form method="post" action="{% url 'accounts:signup' %}">
                    {% csrf_token %}
                    <input type="text" name="username" class="input-field" placeholder="ユーザーID" required>
                    <input type="email" name="email" class="input-field" placeholder="メールアドレス" required>
                    <input type="password" name="password" class="input-field" placeholder="パスワード" required pattern="(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[!@#$%^&*]).{8,}" title="英字・数字・記号を含む8文字以上で入力してください">
                    <!-- パスワードの例　Test@1234 -->
                    <input type="password" name="password_confirm" class="input-field" placeholder="パスワード（確認）" required>
                    <input type="text" name="name" class="input-field" placeholder="名前" required pattern="^[ぁ-んァ-ヶｱ-ﾝﾞﾟ一-龥 　]{1,}$" title="日本語で入力してください">

                    <!-- 最大値は決める？ max="2007-12-31"とか-->
                    <input type="date" name="birth" class="input-field" placeholder="生年月日" required min="1900-01-01">

                    <input type="text" id="id_postal_code" name="postal_code" class="input-field" placeholder="郵便番号" required pattern="\d{7}" title="数字7桁で入力してください（ハイフン不要）">
                    <input type="text" id="id_address" name="address" class="input-field" placeholder="住所" required>
                    <input type="text" name="phone" class="input-field" placeholder="電話番号" required pattern="\d{10,11}" title="数字10〜11桁で入力してください（ハイフン不要）">
                    <button type="submit" class="signup-button">登録する</button>
                </form>

                <div class="divider"></div>

                <a href="{% url 'accounts:login' %}">
                    <button class="login-button">ログイン</button>
                </a>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function(){
        $('#id_postal_code').on('blur', function(){
            let postal = $(this).val();
            if(!/^\d{7}$/.test(postal)){
                alert('郵便番号はハイフンなし7桁で入力してください');
                $('#id_address').val('');
                return;
            }

            $.ajax({
                url: "{% url 'accounts:ajax_get_address' %}",
                data: { postal_code: postal },
                dataType: "json",
                success: function(data){
                    if(data.address){
                        $('#id_address').val(data.address);
                    } else {
                        $('#id_address').val('');
                        alert('住所が見つかりません');
                    }
                },
                error: function(){
                    $('#id_address').val('');
                    alert('住所の取得に失敗しました');
                }
            });
        });
    });
    </script>
</body>
</html>
